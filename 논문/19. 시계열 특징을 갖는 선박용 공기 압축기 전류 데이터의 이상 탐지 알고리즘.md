논문 주제: 시계열 특징을 갖는 선박용 공기 압축기 전류 데이터의 이상 탐지 알고리즘 적용 실험
논문 저자: 이정형
논문 선정 이유: 이상치 탐지 알고리즘 적용
 
논문 URL: https://www.koreascience.or.kr 

  요약
- 선박용 공기압축기의 상태기반보전 시스템에 필요한 이상치 탐지 알고리즘 적용에 대한 실험적 연구
- 고장모사 실험을 통해 시계열 전류 센서 데이터를 이용한 이상탐지 적용 가능성을 확인
- 고장 유형 10개에 대해 실험실 규모의 고장 모사 실험을 수행
- 정상 운전데이터와 고장 데이터를 구축

- 실험 결과 구축된 이상탐지 모델은 시계열 데이터의 주기에 영향을 주는 이상은 잘 탐지
- 반면에 미세한 부하 변동에 대한 탐지 성능은 떨어짐
- 오토인코더를 이용한 시계열 이상탐지 모델은 입력 시퀀스의 길이와 초모수 조정에 따라 이상 탐지 성능이 차이가 남

초모수(=하이퍼파라미터) ex-경사하강법의 학습률(eta)과 최적화방법, 미니배치의 크기 

- 이 실험의 결과로는 이의 최적화를 통한 성능 향상이 과제로 남음

  서론
- 상태기반보전은 상태 감시 기술에 근거하여 설비의 상태를 정확히 진단하므로 고장을 조기에 예측하고 이를 기반으로 정비시기를 결정하여 정비를 시행하는 방식
- 자동화와 유지보수의 지능화에 따라 상태기반보전방식의 적용이 필요해짐
- 고장 진단 알고리즘의 성능은 수집 데이터에 포함된 이상치를 얼마나 잘 찾냐고 중요

- 본 연구의 목적은 공기압축기의 데이터 기반 고장 진단 시스템 구현에 필요한 기초적 연구를 수행
- 본 연구에서는 상기한 기존 연구의 문제점을 해결하기 위해 실험실 규모로 구축된 공기압축기를 이용해 운전 데이터를 확보
- 이를 기반으로 시계열 데이터의 이상치 탐지 알고리즘의 일종인 오토인코더를 적용하여 이상치 탐지 모델을 구축
- 또한 공기압축기의 다양한 고장 유형을 구현한 고장 모사 실험을 통해 고장 데이터를 수집
- 이를 이용하여 이상 탐지 성능을 검증하였다.



 본론

(1) 정상 및 고장 데이터 셋 구축

- 실험대상 : 선박용 공기 압축기  
- 데이터 형태 : 단변량 시계열 특징을 갖는 전류 데이터 (RMS 형태로 변환된 값)    
- 데이터의 종류 : 공기압축기의 정상 운전과 10종의 고장모드에 대한 데이터 

- 고장모드는 결함수 분석을 통해 도출
- 주요 고장 유형을 동력전달계통의 고장, 압축기 및 원동기 고장, 공기 누설로 구분
- 정상 및 고장 시나리오 모두 2분을 주기로 압축공기가 자동으로 배출 및 차단
- 이에 따라 탱크 압력이 감소되고 공기압축기는 자동으로 운전, 정지가 반복되었다. 

(2) 데이터 전처리
- 기계학습 기반 이상탐지 모델 구축을 위해 사용된 정상 운전 데이터는 단일 특징값을 가졌으나 그 수가 방대함(244,274개)
- 훈련데이터로 활용되기 위해서는 전처리가 필요
- 또한 원동기의 전류 데이터는 기동-정지에 반복에 따른 값의 편차가 크며 고장과 무관한 이상치가 수집되기 때문에 이들 데이터는 Z-score법을 이용해 제거
- 이후에는 먼저 원시 데이터(Raw data)는 1초 단위로 재샘플링(Resampling)
- 이어서 최대-최소 정규화를 통해 값의 범위를 0 ~ 1으로 설정
- 전처리 후 데이터 개수는 12,220개였다.

(3) 학습 및 이상탐지 알고리즘 적용
- 오토인코더를 적용(시계열 데이터의 이상치 탐지에서 우수한 성능을 나타내서)
- 오토인코더는 신경망을 이용해 임의의 입력값과 같은 출력값으로 재생성하도록 하는 비지도 학습(Unsupervisedlearning) 기반의 알고리즘
- 오토인코더는 인코더와 디코더로 구성
- 입력층으로 입력된 다차원 데이터가 은닉층으로 전달
- 그래서 저차원으로 축소되며 이는 다시 출력층으로 전달됨
- 그래서 입력데이터와 동일 차원의 데이터로 복원됨
- 은닉계층을 중심으로 인코더와 디코더는 대칭구조
- 입력계층의 노드 수와 출력계층의 노드 수는 항상 동일한 특징을 갖음
- 이 실험에는 가장 단순한 형태의 합성곱 오토인코더 모델을 적용
다양한 구조가 존재 ex) 적층형, 변이형, 잡음제거형 

- 인코더부에 해당하는 2개의 1차원 합성곱층과 디코더부에 해당하는 2개의 합성곱 전치층으로 구성
- 출력층을 제외한 모든 층에 적용된 활성화 함수는 Relu함수
- 위와 같은 모델은 Keras에서 제공하는 Sequential 모델을 이용하여 구성
- 전체 데이터 세트는 학습용 90 %, 검증용 10 %의 비율로 구분
- 학습을 통해 구축된 모델의 성능은 검증용 데이터 세트를 통해 검증되도록 함
- 학습계수 0.001, 배치크기(Batch size) 128로 설정하여 총 50번의 epoch 동안 수행
- 5회 연속 오차 값의 개선이 없을 경우 학습이 조기 종료되도록 설정 
- Adam optimizer를 통해 최적화
- 손실함수는 입력과 복원의 오차의 차에 대한 평균제곱오차 사용
- 
![1](https://user-images.githubusercontent.com/88120044/128639808-6cc0105c-ffa6-4e5e-b179-9017ba560d3d.png)

- 위의 사진은 학습 과정 중 손실함수 값의 곡선을 나타냄
- 훈련 손실(Training loss)은 훈련 초기에 최저치에 도달
- 검증 손실(Validation loss)은 8 epoch까지는 훈련 손실함수 값을 상회하여 차이를 보임 
- 그러나 학습이 진행됨에 따라 10 epoch 이후에는 두 손실함수 값은 0에 수렴
 본론

(1) 고장모드 별 데이터 관찰
- 아래의 시계열 그래프는 공기압축기의 정상 운전 중 1 사이클에 대한 시간에 따른 전류값의 변화를 나타냄
- 1사이클은 압축공기가 사용처에서 소비되어 공기압축기의 기동-운전-자동정지에 이르는 기간으로 정의
- ①은 공기 압축기 기동 전 대기 상태이며 0에 가까운 값
- 압축공기가 소모됨에 따라 ②시점에서 압축기의 압력스위치의 작동에 의해 자동 기동됨
- ②시점의 전류값은 기동부하의 영향으로 피크치가 관찰된다. 
- 기동 직후 전류치는 순간적으로 감소하여 정상 운전 시(③)에는 약 0.65 ~ 7 A를 나타내고 있으며 탱크 압력 상승에 따라 미세하게 우상향함을 나타냄
- 이후 공기압축기는 계속 운전되어 정해진 탱크 용량까지 보충됨
- 탱크의 압력이 압력스위치의 설정치 상한값에 이르면 압축기는 정지하며 다음 기동까지 대기
- 
- ![2](https://user-images.githubusercontent.com/88120044/128639852-f3d66ea6-e7fc-4264-a2ea-77e2c3f5d868.png)

- 아래의 시계열 그래프는 10종의 고장 모드에 대한 고장 모사 실험으로부터 취득한 전류의 시계열 그래프
- x축은 시간, y축은 전류(부하)의 크기를 의미
- 고장모드 1, 2, 3, 6, 9의 화살표는 고장 모사 실험이 중단된 시점을 의미
- 전류값이 0을 나타낸 것은 안전 상 실험을 강제로 중단함을 의미(고장 부여가 원인이 아님)

![3](https://user-images.githubusercontent.com/88120044/128639857-67fbeaf4-0128-41c4-b26e-fd8c4366327c.png)

- 10가지 원인은 논문에 나와 있음 (우리와 관련이 없어서 작성 x) 
- 이상의 관찰을 통해 고장 모드 구현에 의한 운전 중 전류 신호의 패턴을 파악함
- 고장 모드 별 전류 데이터는 전반적으로 정상 운전과 유사한 경향을 보이고 있음
- 그러나 운전 주기와 운전 중 부하 크기에 차이를 보임
- 따라서 이 같은 특징을 응용한 이상 탐지 모델의 구축이 가능하다고 판단

- 피크값이 고장 모드 별로 패턴을 안 갖어서, 이상 탐지에 유용하지 않은 값으로 판단
- 그래서 전처리 과정에서 제거함

- 이 연구에서의 전류 센서값은 단일 특징값을 갖는 시계열 데이터로서 이상 탐지에 유효한 정보
- 그러나 고장 모드의 식별(분류)에는 유용하지 않은 정보임에 유의
- 즉, 전류의 RMS값은 단독적으로 고장 패턴 분류에 적합하지 않은 특징임 
- 그래서 고장 패턴 분류를 위해서는 추가적인 특징값 선정이 필요할 것으로 판단됨

(2) 이상 기준치 설정
- 공기압축기의 경보(Alarm)는 공기의 상한 및 하한값, 공기압축기의 이상으로 단순하게 구성
- 상태기반보전에 적용하기에 객관성이 떨어지고(경험에 의거해서) 유용성이 떨어짐
- 그래서 오토인코더를 적용하여 이상 판단의 기준치 재설정
- 오토인코더 기반의 이상탐지는 재구성 오차의 계산과 임계치(Threshold) 설정에 의해 이상 여부를 판정
- 오토인코더의 학습은 재구성오차가 최소화되도록 진행됨
(재구성 오차 = 복원 오차 = 입력과 출력 사이의 오차)

- 재구성 오차는 이상치 점수(Anomaly score)로 작동
- 재구성 오차는 임계치와의 비교를 통해 이상여부를 결정함 
- 즉, 정상 데이터로 학습시킨 모델은 정상 데이터에 대해서는 낮은 재구성 오차
를 나타냄
- 이상 데이터에 대해서는 높은 재구성 오차를 나타냄
- 따라서 정상 데이터를 대상으로 모델을 학습시키고 재구성 오차에 대한 임계치를 결정하게 되며 이를기준으로 입력 데이터의 이상/정상 여부를 판정

- 아래의 그래프는 합성곱 기반 오토인코더 모델의 학습 후 훈련 데이터에 대한 재구성 오차의 분포를 의미
- 재구성 오차는 평균절대오차를 이용하여 계산된 값
- 입출력 간 오차 분포는 그래프의 왼쪽에 치우침
- 이상 기준치 설정을 위한 임계치는 재구성 오차의 최대값(0.014)으로 설정 
- 이렇게 얻어진 임계치는 이상 데이터에 학습 모델에 주입하여 얻은 재구성 오차에서 이상 여부를 판단하는 기준치로 작동

- ![4](https://user-images.githubusercontent.com/88120044/128639854-fe2ad67a-e10e-4260-a964-e8339b200f17.png)


- 아래의 그래프는 180초 단위의 첫 번째 입력시퀀스에 대해 복원된 출력을 나타냄
- 정상 운전 중의 데이터를 포함(청색), 복원된 출력(오렌지색)
- 청색에 대해 오렌지색이 형상적으로는 근접하게 복원되었으나 약간의 차이를 나타냄

- ![5](https://user-images.githubusercontent.com/88120044/128639855-61eca3a7-6567-464a-8b0c-5685aa3a05dd.png)


(3) 이상탐지 가능성 검토

- 정상 운전 데이터를 기반으로 오토인코더를 이용하여 입력 시퀀스의 길이(180초, 240초- 각각 모델 A, B로 명명)를 변수로 하여 2개의 이상 탐지 모델을 구축
- 아래와 같이 정상운전과 2종의 고장 신호가 포함된 데이터를 구축된 모델에 주입하여 이상탐지 가능성을 검토하였다.
- 구축된 이상탐지 모델은 실제 운전 및 고장 데이터를 이용해 제작한 인공 데이터 셋(Synthetic dataset)을 통해 검증

가정된 고장(1) : 검증 데이터의 시나리오에서는 정상 운전 중이던 공기압축기가 2020년 12월 11일 11시 05분경 고장모드 3(압축공기의 미량누설)에 의한 고장이 발생하여 쇼트사이클 운전을 한 후 11시 25분경 정상으로 복구됨
가정된 고장(2) : 이후 공기압축기는 다시 정상 운전을 시작하였으며, 12시 25분 경 기동과 함께 V-벨트가 이탈된 상황을 가정하였다. 


- 아래의 그래프는 검증시나리오에 대한 공기압축기 운전 전류의 시계열 데이터임
- a와 b는 각각 이상탐지모델 A와 B를 적용한 이상탐지 결과를 보여줌
- 음영으로 표시된 부분은 시계열 특징을 갖는 전류 데이터의 이상 탐지 알고리즘 적용 실험 실제 고장이 발생한 부분(True anomaly)
- 빨간 색 점은 이상탐지모델에 의해 이상이 탐지된 부분을 의미

- ![6](https://user-images.githubusercontent.com/88120044/128639856-59d27473-72ba-41f6-b815-dc6c5e1252f5.png)

 결과

- 모델 A는 2개의 실제 고장에 대해 이상탐지가 잘 되었다고 판단됨
- 모델 B는 모델 A와 같이 실제 고장에 대한 이상 탐지뿐만 아니라 정상 운전 데이터에 대해서도 이상이라 거짓 탐지한 부정오류(False negative) 문제를 보여줌
- 다른 8개의 고장 모드에 대해서도 인공 데이터셋을 검증한 결과, 공기누설과 같은 주기에 변화가 유발되는 고장 모드는 이상 탐지가 잘 이루어짐
- 하지만 부하의 미세한 변화가 관찰되는 베어링 고장 등의 유형은 탐지하지 못함

 고찰

- 본 연구에서는 초모수(Hyperparameter)의 최적화를 통한 모 델의 성능 개선은 고려하지 않음
- 초모수는 오토인코더로 학습시킨 모델의 이상 탐지 성능에 영향을 미치는 요소이므
로 향후 추가적인 연구가 필요할 것으로 판단됨
- 또한 비지도학습 기반의 이상탐지 모델 특성 상 정답 레이블이 없으므로 Accuracy, Recall, Precision, F1-score 등을 통한 성능 평가를 적용하기 어렵다는 한계 존재
- 따라서 이상탐지 모델의 성능 평가를 위해 데이터의 이상 정도를 측정할 수 있는 성능지표 개발이 필요하다고 판단됨


